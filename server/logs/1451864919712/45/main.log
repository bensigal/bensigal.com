/server/getFileContents

Session found.
{ id: 'f1917623c4e0a13f7f8659c35c0a468c00a7336de19defb2d6eff6668f64d89a1cfdaa476a5e2452cb2e97269795b204',
  on: true,
  un: 'Ben',
  pwd: '44MeepsGiven' }

POST, not multipart. Assuming querystring. Actual: application/x-www-form-urlencoded; charset=UTF-8
Waiting for body before sending through tunnel...
edit=%2Fhome%2Fbensigal%2Fserver%2Fwww%2Fedit%2Feditor.js
Sending through tunnel /
Tunnel not found at /home/bensigal/server/www/tunnel.node.js
At default tunnel
Sending through tunnel /server/
Reading file contents for /home/bensigal/server/www/edit/editor.js
Sending /home/bensigal/server/www/edit/editor.js with options { pathNotFromWww: true,
  notFoundCallback: [Function],
  encoding: 'binary' }
'var currentEditor=1;\nvar editors=[];\nvar noEditors=0;\nvar tabs;\nvar selectedFile="";\nvar selectedDir="";\nvar currentDir="/home/bensigal/server/www";\nvar readers  = [];\nvar vals\t = [];\nvar fileNames= [];\n$(function(){\n\ttabs = $("#tabs").tabs();\n\t$("#tabs").on("tabsactivate", function(event, ui){\n\t\tcurrentEditor=ui.newTab.index()+1;\n\t\t$("#editor"+currentEditor).height("calc(100vh - 146px)");\n\t\teditors[currentEditor].editor.focus();\n\t});\n\tvar fakeui = {};\n\tfakeui.newTab={};\n\tfakeui.newTab.index = function(){return 0;};\n\teditors[1]=new BenEditor(1);\n\tnoEditors=1;\n\t$("#tabs").trigger("tabsactivate", [fakeui]);\n\ttabs.delegate( "span.ui-icon-close", "click", function() {\n\t\tvar panelId = $( this ).closest( "li" ).remove().attr( "aria-controls" );\n\t\t$( "#" + panelId ).remove();\n\t\ttabs.tabs( "refresh" );\n\t\tnoEditors--;\n\t});\n\t$(".ui-widget-header").css({backgroundImage: "none"});\n});\nvar BenEditor = function(num, str){\n\tthis.editor = ace.edit("editor"+num);\n\tthis.editor.setOption("showPrintMargin", false);\n\tthis.editor.setTheme("ace/theme/cobalt");\n\tthis.editor.setOptions({\n\t\tfontSize: "16px"\n\t});\n\tif(str){\n        if(str.indexOf(".")>-1){\n            str = str.split(".").pop();\n        }\n\t\tchangeLanguage(str, this.editor);\n\t}\n};\nfunction changeLanguage(str, editor){\n\tswitch(str){\n\tcase "js":\n\t\tstr="javascript";\n\t\tbreak;\n\tcase "html":\n\tcase "shtml":\n\tcase "htm":\n\tcase "php":\n\t\tstr="php";\n\t\tbreak;\n\tcase "java":\n\tcase "json":\n\tcase "css":\n\t\tbreak;\n\tdefault:\n\t\tstr=false;\n\t}\n\tif(!str){\n\t\teditor.getSession().setMode("text");\n\t}else{\n\t\teditor.getSession().setMode("ace/mode/"+str);\n\t}\n}\nvar dirMenu = {\n\tselector:".dirButton",\n\tcallback:function(key, options){\n\t\tif(key=="Delete"){\n\t\t\tif(confirm("Are you sure?")){\n\t\t\t\tdelDir(this[0].innerHTML)\n\t\t\t}\n\t\t}else{\n\t\t\tvar s=prompt("What shall it be called?\\n\\n"+\n\t\t\t"To move a file or folder, type in a relative path"+\n\t\t\t"as the new name. If you don\'t know what that is,"+\n\t\t\t"why are you using my editor?");\n\t\t\tif(s){\n\t\t\t\trenameFile(this[0].innerHTML, s);\n\t\t\t}\n\t\t}\n\t},\n\titems:{\n\t\tDelete:{name:"Delete"},\n\t\t"Rename/Move":{name:"Rename/Move"}\n\t}\n}\nvar fileMenu = {\n\tselector:".fileButton",\n\tcallback:function(key, options){\n\t\tif(key=="Delete"){\n\t\t\tif(confirm("Are you sure?")){\n\t\t\t\tdeleteFile(this[0].innerHTML)\n\t\t\t}\n\t\t}else if(key=="Rename/Move"){\n\t\t\tvar s=prompt("What shall it be called?\\n\\n"+\n\t\t\t"To move a file or folder, type in a relative path"+\n\t\t\t"as the new name. If you don\'t know what that is,"+\n\t\t\t"why are you using my editor?");\n\t\t\tif(s){\n\t\t\t\trenameFile(this[0].innerHTML, s);\n\t\t\t}\n\t\t}else{\n\t\t\tdownload(currentDir+this[0].innerHTML);\n\t\t}\n\t},\n\titems:{\n\t\tDelete:{name:"Delete"},\n\t\t"Rename/Move":{name:"Rename/Move"},\n\t\tDownload:{name:"Download"}\n\t}\n}\nfunction activateContextMenu(){\n\t$(function(){\n\t\t$.contextMenu(dirMenu);\n\t\t$.contextMenu(fileMenu);\n\t\t$(".dirButton").on("contextmenu", function(event){\n\t\t\tselectedDir=event.target.innerHTML;\n\t\t});\n\t\t$(".fileButton").on("contextmenu", function(event){\n\t\t\tselectedFile=event.target.innerHTML;\n\t\t});\n\t});\n}\nfunction changeFiles(s, e){\n\tif(e)e.stopPropagation();\n\tif(s.substring(s.length-1)!="/"){\n\t\ts+="/";\n\t}\n\tcurrentDir=s;\n\t$.post("/server/siteMap", {dir:s}, function(data){\n\t\t//Data is in format:\n\t\t//dir1;dir2;dir3<newline>\n\t\t//file1;file2;file3\n\t\tdata=data.split("\\n");\n\t\tvar dirs=data[0];\n\t\tvar files=data[1];\n\t\tdirs=dirs.split(";");\n\t\tfiles=files.split(";");\n\t\tvar strTemp=currentDir.substring(0,currentDir.length-1);\n\t\tif(strTemp.indexOf("/")+1){\n\t\t\tstrTemp=strTemp.substring(0,strTemp.lastIndexOf("/"));\n\t\t\tconsole.log("STRTEMP: "+strTemp);\n\t\t}else{\n\t\t\tstrTemp="";\n\t\t}\n\t\t//This is bad OOP. I should probably change it.\n\t\tdirsString="<div class=\'dirButton\' onclick=\'changeFiles(\\""+\n\t\tstrTemp+"\\",event)\'>../</div>";\n\t\tfor(var i in dirs){\n\t\t\tdirsString+="<div class=\'dirButton\' "+\n\t\t\t"onclick=\'changeFiles(\\""+currentDir+dirs[i]+"\\", event)\'>"+\n\t\t\tdirs[i]+"</div>";\n\t\t}\n\t\tdirsString="<td id=\'dirsHolder\'>"+dirsString+"</td>";\n\t\tvar filesString="";\n\t\tfor(i in files){\n\t\t\tfilesString+="<div class=\'fileButton\' onclick=\'trykeyfile(\\""+currentDir+\n\t\t\tfiles[i]+"\\");"+\n\t\t\t"closeFiles()\'>"+files[i]+"</div>";\n\t\t}\n\t\tfilesString="<td id=\'filesHolder\'>"+filesString+"</td>";\n\t\t$("#inner").html("<table id=\'table\'><tr>"+dirsString+filesString+\n\t\t\t"</tr></table>"+\n\t\t\t\'<section id="optionsHolder">\'+\n\t\t\t\t"<div id=\'newDir\' "+\n\t\t\t\t\t"onclick=\'newDir(prompt(\\"What should its name be?\\"))\'>"+\n\t\t\t\t\t"New Directory</div>"+\n\t\t\t\t"<div id=\'newFile\' onclick=\'"+\n\t\t\t\t\t\'var s = prompt("What should its name be?");if(s){\'+\n\t\t\t\t\t"editors[currentEditor].file=currentDir+s;"+\n\t\t\t\t\t\'editors[currentEditor].editor.setValue("");save();\'+\n\t\t\t\t\t\'trykeyfile(editors[currentEditor].file);\'+\n\t\t\t\t\t"changeFiles(currentDir);}"+\n\t\t\t\t"\'>New File</div>"+\n\t\t\t\t"<div id=\'uploadButton\' onclick=\'$(\\"#file\\").click()\'>"+\n\t\t\t\t\t"Upload</div>"+\n\t\t\t"</section>"\n\t\t);\n\t\tactivateContextMenu();\n\t});\n}\n\ndocument.onkeydown=function(e){\n\tif(e.keyCode>48&&e.keyCode<58&&(e.ctrlKey||e.altKey)){ //CTRL/alt + 1-9\n\t\tvar keyNum = e.keyCode - 48;\n\t\tif(editors[keyNum]){\n\t\t\te.preventDefault();\n\t\t\t$("#link"+(keyNum)).click();\n\t\t}\n\t}\n\telse if(e.keyCode==87&&e.altKey){\n\t\t$(".ui-state-active > span").click();\n\t}\n\telse if(e.keyCode==78&&(e.ctrlKey||e.altKey)){ //CTRL/alt + N\n\t\tconsole.log("MEEP");\n\t\te.preventDefault();\n\t\tif(noEditors==9)return;\n\t\tnoEditors++;\n\t\t$("div#tabs ul").append(\n\t\t\t"<li><a href=\'#win" + noEditors + "\' id=\'link"+noEditors+"\'>File " + noEditors + \n\t\t\t"</a><span class=\'ui-icon ui-icon-close\' role=\'presentation\'>Remove Tab</span></li>"\n\t\t);\n\t\t$("div#tabs").append(\n\t\t\t"<div id=\'win" + noEditors + "\'><div id=\'editor" + noEditors + "\'></div></div>"\n\t\t);\n\t\t$("div#tabs").tabs("refresh");\n\t\teditors[noEditors]=new BenEditor(noEditors);\n\t\t$("#link"+noEditors).click();\n\t\tviewFiles(currentDir);\n\t}\n\telse if(e.keyCode==83&&(e.ctrlKey||e.altKey)){ //CTRL/alt + S\n\t\te.preventDefault();\n\t\tsave();\n\t}\n\telse if(e.keyCode==79&&(e.altKey||e.ctrlKey)){ //ALT/ctrl + O\n\t\te.preventDefault();\n\t\tif($("#article").css("display")=="table")\n\t\t\tcloseFiles();\n\t\telse\n\t\t\tviewFiles(currentDir);\n\t}\n\telse if(e.keyCode==76&&(e.altKey||e.ctrlKey)){   //ALT/ctrl + L\n\t\te.preventDefault();\n\t\tlogout();\n\t}\n\telse if(e.keyCode==82&&(e.altKey||e.altKey)){ //ALT/ctrl + R\n\t\te.preventDefault();\n\t\ttrykeyfile(editors[currentEditor].editor.file);\n\t}\n};\n\nfunction save(){\n\t$("body").animate({backgroundColor: "#990"}, 400);\n\tvar formData = new FormData();\n\tformData.append("file",editors[currentEditor].file);\n\tformData.append("contents",new File([\n\t    new Blob(\n\t       [editors[currentEditor].editor.getValue()], \n\t       {type:"application/octet-stream"}\n\t   )\n\t], "temp.txt"));\n\t$.ajax("/server/save",{\n\t\t\'data\':formData,\n\t\t\'contentType\':false,\n\t\t\'processData\':false,\n\t\t\'type\':"POST",\n\t\t\'success\':function(data){\n\t\t\tif(data=="Success!"){\n\t\t\t\t$("body").animate({backgroundColor: "#090"},400);\n\t\t\t}else{\n\t\t\t\t$("body").animate({backgroundColor:"#900"},400,function(){\n\t\t\t\t\tviewText(data.replace(/<[^>]+?>/g,""));\n\t\t\t\t});\n\t\t\t}\n\t\t\t$("body").animate({backgroundColor:"#39B"},400);\n\t\t},\n\t\t\'error\':function(jqXHR, statusString, status){\n\t\t\tviewText(status);\n\t\t}\n\t});\n}\n\nfunction trykeyfile(f){\n\t$.post("/server/getFileContents", {edit: f}, function(data){\n\t    console.log("Data recieved. File: "+f)\n\t\teditors[currentEditor].editor.setValue(data, -1);\n\t\teditors[currentEditor].file=f;\n\t\tchangeLanguage(\n\t\t\teditors[currentEditor].file.split(".").pop(),\n\t\t\teditors[currentEditor].editor\n\t\t);\n\t\t$("#link"+currentEditor).text(\n\t\t\teditors[currentEditor].file.substring(\n\t\t\t\teditors[currentEditor].file.lastIndexOf("/") + 1\n\t\t\t)\n\t\t);\n\t});\n}\nfunction viewFiles(s){\n\tchangeFiles(s);\n\tvar colors="200,200,230";\n\t$("article").css("background-color", "rgba("+colors+", 0)");\n\t$("article").css("display", "table");\n\t$("article").animate({\n\t\tbackgroundColor:"rgba("+colors+", 0.93)"\n\t})\n\t$("aside").animate({opacity:1})\n\t$("article, aside").click(function(event){\n\t\tif(event.target===this){\n\t\t\tcloseFiles();\n\t\t}\n\t});\n}\nfunction viewText(s, t){\n\tvar colors;\n\t$("#inner").html(s);\n\tif(t){\n\t\tcolors="220,25,25";\n\t\t$("article").css("background-color", "rgba("+colors+", 0)");\n\t}else{\n\t\tcolors="102,102,102";\n\t\t$("article").css("background-color", "rgba("+colors+", 0)");\n\t}\n\t$("article").css("display", "table");\n\t$("article").animate({\n\t\tbackgroundColor:"rgba("+colors+", 0.93)"\n\t})\n\t$("aside").animate({opacity:1})\n\t$("article, aside").click(function(event){\n\t\tif(event.target===this){\n\t\t\tcloseFiles();\n\t\t}\n\t});\n}\nfunction closeFiles(){\n\t$("#editor").css("display", "table");\n\t$("body").animate({backgroundColor:"#39B"});\n\t$("article").animate({backgroundColor:"rgba(102,102,102,0)"},\n\t\tfunction(){\n\t\t\t$("article").css("display", "none");\n\t\t\t$("article").css("background-color", "#666");\n\t\t\teditors[currentEditor].editor.focus();\n\t\t}\n\t);\n\t$("aside").animate({opacity:0})\n}'
